<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitHub Pages Detector with AI Ideas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .loader {
        border-top-color: #3498db;
        -webkit-animation: spin 1s linear infinite;
        animation: spin 1s linear infinite;
      }
      @-webkit-keyframes spin {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .gemini-loader {
        border-top-color: #8b5cf6;
      }
    </style>
  </head>
  <body
    class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4"
  >
    <div class="w-full max-w-md">
      <div class="bg-gray-800 shadow-lg rounded-2xl p-6 md:p-8">
        <div class="text-center mb-6">
          <h1 class="text-2xl md:text-3xl font-bold text-cyan-400">
            GitHub Pages Detector
          </h1>
          <p class="text-gray-400 mt-2">
            Find a repo with GitHub Pages, then get AI-powered project ideas!
          </p>
        </div>

        <!-- Input form -->
        <div class="flex flex-col sm:flex-row gap-3">
          <input
            type="text"
            id="username"
            placeholder="Enter GitHub Username"
            class="flex-grow bg-gray-700 text-white placeholder-gray-500 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-gray-600 transition duration-300"
          />
          <button
            id="check-btn"
            class="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="mr-2"
            >
              <path
                d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4m-8-18v18m-4-14h4m-4 4h4m-4 4h4m-4 4h4"
              />
            </svg>
            Check
          </button>
        </div>

        <!-- Results and status area -->
        <div id="result" class="mt-6 text-center"></div>
        <!-- Gemini features will be injected here -->
        <div id="gemini-output" class="mt-4 text-left"></div>
      </div>
      <footer class="text-center mt-6 text-gray-500 text-sm">
        <p>Made for the community. Free to use.</p>
      </footer>
    </div>

    <script>
      const usernameInput = document.getElementById("username");
      const checkBtn = document.getElementById("check-btn");
      const resultDiv = document.getElementById("result");
      const geminiOutputDiv = document.getElementById("gemini-output");

      // Function to show a loading spinner
      const showLoader = (container, message) => {
        container.innerHTML = `
                <div class="flex justify-center items-center mt-4">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-500 h-12 w-12"></div>
                </div>
                <p class="text-gray-400 mt-2">${message}</p>
            `;
      };

      // Function to display results
      const displayResult = (repo, username) => {
        const pagesUrl = `https://${username}.github.io/${repo.name}/`;
        resultDiv.innerHTML = `
                <div class="bg-gray-700 rounded-lg p-4 text-left animate-fade-in">
                    <h3 class="font-bold text-lg text-green-400">GitHub Pages Site Found!</h3>
                    <p class="text-gray-300 mt-2">
                        <span class="font-semibold">Repository:</span> 
                        <a href="${repo.html_url}" target="_blank" class="text-cyan-400 hover:underline">${repo.name}</a>
                    </p>
                    <p class="text-gray-300 mt-1">
                        <span class="font-semibold">Live URL:</span> 
                        <a href="${pagesUrl}" target="_blank" class="text-cyan-400 hover:underline">${pagesUrl}</a>
                    </p>
                </div>
            `;
        // TODO: Uncomment the following lines to enable Gemini suggestions
        // <div class="mt-4">
        //     <button id="gemini-btn" class="w-full bg-violet-600 hover:bg-violet-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center">
        //        ✨ Suggest New Projects
        //     </button>
        // </div>
        document
          .getElementById("gemini-btn")
          .addEventListener("click", () => getProjectIdeas(repo));
      };

      // Function to display a "not found" message
      const displayNotFound = (username) => {
        resultDiv.innerHTML = `
                <div class="bg-yellow-900/50 border border-yellow-700 text-yellow-300 rounded-lg p-4 animate-fade-in">
                    <h3 class="font-bold text-lg">No Active Site Found</h3>
                    <p class="mt-1">We couldn't find a repository with GitHub Pages enabled for the user <strong class="font-semibold">${username}</strong>.</p>
                </div>
            `;
        geminiOutputDiv.innerHTML = ""; // Clear Gemini output
      };

      // Function to display an error message
      const displayError = (message) => {
        resultDiv.innerHTML = `
                <div class="bg-red-900/50 border border-red-700 text-red-300 rounded-lg p-4 animate-fade-in">
                    <h3 class="font-bold text-lg">An Error Occurred</h3>
                    <p class="mt-1">${message}</p>
                </div>
            `;
        geminiOutputDiv.innerHTML = ""; // Clear Gemini output
      };

      // --- Gemini API Integration ---

      //   async function getProjectIdeas(repo) {
      //     showLoader(
      //       geminiOutputDiv,
      //       "✨ Gemini is thinking of new project ideas..."
      //     );

      //     const repoName = repo.name;
      //     const repoDescription = repo.description || "a web project";

      //     const prompt = `Based on a GitHub project called "${repoName}" which is described as "${repoDescription}", generate 3 creative and distinct project ideas that a student could build for their portfolio. These projects should be suitable for hosting on GitHub Pages (static sites using HTML, CSS, JS). Provide a catchy title and a 1-2 sentence description for each idea.`;

      //     try {
      //       let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
      //       const payload = { contents: chatHistory };
      //       const apiKey = ""; // API key will be managed by the environment
      //       const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

      //       const response = await fetch(apiUrl, {
      //         method: "POST",
      //         headers: { "Content-Type": "application/json" },
      //         body: JSON.stringify(payload),
      //       });

      //       if (!response.ok) {
      //         throw new Error(`Gemini API error! Status: ${response.status}`);
      //       }

      //       const result = await response.json();

      //       if (
      //         result.candidates &&
      //         result.candidates.length > 0 &&
      //         result.candidates[0].content &&
      //         result.candidates[0].content.parts &&
      //         result.candidates[0].content.parts.length > 0
      //       ) {
      //         const text = result.candidates[0].content.parts[0].text;
      //         displayProjectIdeas(text);
      //       } else {
      //         throw new Error(
      //           "Received an unexpected response structure from Gemini API."
      //         );
      //       }
      //     } catch (error) {
      //       console.error("Gemini API Error:", error);
      //       geminiOutputDiv.innerHTML = `<div class="bg-red-900/50 text-red-300 p-3 rounded-lg">Failed to get ideas. ${error.message}</div>`;
      //     }
      //   }

      //   function displayProjectIdeas(ideasText) {
      //     // Simple parsing assuming the model returns a Markdown-like format
      //     const ideasHtml = ideasText
      //       .split(/\n\s*\n/) // Split by blank lines
      //       .map((idea) => {
      //         if (!idea.trim()) return "";
      //         // Make the title bold
      //         const formattedIdea = idea.replace(/^\*?\*?([^:]+):/, "**$1:**");
      //         return `<div class="bg-gray-700/50 p-4 rounded-lg mb-3 animate-fade-in">${formattedIdea
      //           .replace(
      //             /\*\*(.*?)\*\*/g,
      //             '<strong class="text-violet-300">$1</strong>'
      //           )
      //           .replace(/\n/g, "<br>")}</div>`;
      //       })
      //       .join("");

      //     geminiOutputDiv.innerHTML = `
      //             <h3 class="text-xl font-bold text-violet-400 mb-3 text-center">Project Ideas ✨</h3>
      //             ${ideasHtml}
      //         `;
      //   }

      // Main function to check for GitHub Pages
      const checkPages = async () => {
        const username = usernameInput.value.trim();
        if (!username) {
          displayError("Please enter a GitHub username.");
          return;
        }

        geminiOutputDiv.innerHTML = ""; // Clear previous Gemini results
        showLoader(resultDiv, "Checking repositories...");

        try {
          let foundRepo = null;
          for (let page = 1; page <= 5; page++) {
            // Check up to 500 repos
            const response = await fetch(
              `https://api.github.com/users/${username}/repos?per_page=100&page=${page}`
            );

            if (response.status === 404)
              throw new Error(`User '${username}' not found.`);
            if (!response.ok)
              throw new Error(`GitHub API error. Status: ${response.status}`);

            const repos = await response.json();
            if (repos.length === 0) break;

            const pagesRepo = repos.find((repo) => repo.has_pages);
            if (pagesRepo) {
              foundRepo = pagesRepo;
              break;
            }
          }

          if (foundRepo) {
            displayResult(foundRepo, username);
          } else {
            displayNotFound(username);
          }
        } catch (error) {
          console.error("Error fetching data:", error);
          displayError(error.message);
        }
      };

      // Event Listeners
      checkBtn.addEventListener("click", checkPages);
      usernameInput.addEventListener("keydown", (event) => {
        if (event.key === "Enter") checkPages();
      });

      // Add a simple fade-in animation for the results
      const style = document.createElement("style");
      style.innerHTML = `
            @keyframes fade-in {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fade-in {
                animation: fade-in 0.5s ease-out forwards;
            }
        `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
